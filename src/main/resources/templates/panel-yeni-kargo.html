<!doctype html>
<!-- Layout Dialect ve Security namespace'leri -->
<html lang="tr" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/panel_layout}"> <!-- Kullanılacak layout dosyası -->
<head>
    <title>Yeni Kargo Kaydı</title>
    <!-- Opsiyonel: Bu sayfaya özel stil varsa -->
    <th:block layout:fragment="page_styles">
        <style>
            /* Gerekirse forma özel stiller buraya eklenebilir */
            .form-label { font-weight: 500; }
            /* Select'in görünümünü iyileştirme */
            .form-select { background-position: right 0.75rem center; }
        </style>
    </th:block>
</head>
<body>

<!-- Ana İçerik -->
<div layout:fragment="content">

    <div class="py-3 text-center">
        <h2 class="border-bottom pb-2 mb-3">Yeni Kargo Kayıt Formu</h2>
        <p class="lead">Lütfen gönderici, alıcı ve kargo bilgilerini eksiksiz giriniz.</p>
    </div>

    <!-- Form -->
    <!-- TODO: th:action ve th:object eklenmeli. Hata/Başarı mesajları için th:if eklenecek -->
    <form class="needs-validation" novalidate method="post" th:action="@{/panel/yeni-kargo}" th:object="${createCargoRequest}"> <!-- Varsayılan DTO adı -->
        <!-- Başarı Mesajı -->
        <div th:if="${successMessage}" class="alert alert-success" role="alert">
            <span th:text="${successMessage}">Kayıt başarılı!</span>
            <strong th:if="${trackingNumber}" th:text="${' Takip Numarası: ' + trackingNumber}"></strong>
        </div>
        <!-- Genel Hata Mesajı -->
        <div th:if="${formError}" class="alert alert-danger" role="alert" th:text="${formError}">
            Form kaydedilirken bir hata oluştu.
        </div>
        <!-- Validation Hataları için Genel Mesaj -->
        <div th:if="${#fields.hasGlobalErrors()}" class="alert alert-danger" role="alert">
            <p th:each="err : ${#fields.globalErrors()}" th:text="${err}">Global Hata</p>
        </div>


        <div class="row g-5">
            <!-- Gönderici Kolonu -->
            <div class="col-md-6">
                <h4>Gönderici Bilgileri</h4>
                <div class="row g-3">
                    <div class="col-12">
                        <label for="senderName" class="form-label">Ad Soyad / Firma Adı</label>
                        <input type="text" class="form-control" id="senderName" placeholder="" th:field="*{senderName}" required>
                        <!-- Validation hatası -->
                        <div class="invalid-feedback" th:if="${#fields.hasErrors('senderName')}" th:errors="*{senderName}">
                            Gönderici adı gerekli.
                        </div>
                    </div>
                    <div class="col-12">
                        <label for="senderAddress" class="form-label">Adres</label>
                        <textarea class="form-control" id="senderAddress" rows="3" th:field="*{senderAddress}" required></textarea>
                        <div class="invalid-feedback" th:if="${#fields.hasErrors('senderAddress')}" th:errors="*{senderAddress}">
                            Adres gerekli.
                        </div>
                    </div>
                    <div class="col-md-6">
                        <label for="senderCity" class="form-label">Şehir</label>
                        <input type="text" class="form-control" id="senderCity" placeholder="" th:field="*{senderCity}" required>
                        <div class="invalid-feedback" th:if="${#fields.hasErrors('senderCity')}" th:errors="*{senderCity}">
                            Şehir gerekli.
                        </div>
                    </div>
                    <div class="col-md-6">
                        <label for="senderPhone" class="form-label">Telefon</label>
                        <!-- İlçe input'u orijinal tasarımda var ama CreateCargoRequest'te yoktu, şimdilik kaldırıldı veya eklenmeli -->
                        <input type="tel" class="form-control" id="senderPhone" placeholder="" th:field="*{senderPhone}" required>
                        <div class="invalid-feedback" th:if="${#fields.hasErrors('senderPhone')}" th:errors="*{senderPhone}">
                            Telefon gerekli.
                        </div>
                    </div>
                    <div class="col-12"> <!-- Tam genişlik yaptım -->
                        <label for="senderEmail" class="form-label">E-posta <span class="text-muted">(Opsiyonel)</span></label>
                        <input type="email" class="form-control" id="senderEmail" placeholder="isim@ornek.com" th:field="*{senderEmail}">
                        <div class="invalid-feedback" th:if="${#fields.hasErrors('senderEmail')}" th:errors="*{senderEmail}">
                            Geçerli bir e-posta adresi girin.
                        </div>
                    </div>
                </div>
                <hr class="my-4">
                <h4>Kargo Detayları</h4>
                <div class="row g-3">
                    <div class="col-md-4">
                        <label for="weight" class="form-label">Ağırlık (kg)</label>
                        <input type="number" step="0.1" class="form-control" id="weight" placeholder="" th:field="*{weight}" required>
                        <div class="invalid-feedback" th:if="${#fields.hasErrors('weight')}" th:errors="*{weight}">
                            Ağırlık gerekli.
                        </div>
                    </div>
                    <div class="col-md-8">
                        <label for="dimensions" class="form-label">Boyutlar (EnxBoyxYük - cm)</label>
                        <input type="text" class="form-control" id="dimensions" placeholder="Örn: 30x40x20" th:field="*{dimensions}">
                        <!-- Bu alan DTO'da zorunlu değildi sanırım -->
                    </div>
                    <div class="col-12">
                        <label for="contentDescription" class="form-label">İçerik Açıklaması</label>
                        <input type="text" class="form-control" id="contentDescription" placeholder="" th:field="*{contentDescription}" required>
                        <div class="invalid-feedback" th:if="${#fields.hasErrors('contentDescription')}" th:errors="*{contentDescription}">
                            İçerik açıklaması gerekli.
                        </div>
                    </div>
                    <!-- Orijinal DTO'da olmayan alanlar şimdilik yorum satırı -->
                    <!-- <div class="col-md-6">
                      <label for="cargoType" class="form-label">Kargo Tipi</label>
                       <select class="form-select" id="cargoType" required>...</select>
                    </div>
                    <div class="col-md-6">
                      <label for="cargoValue" class="form-label">Beyan Edilen Değer <span class="text-muted">(Opsiyonel)</span></label>
                      <input type="number" class="form-control" id="cargoValue" placeholder="TL">
                    </div> -->
                </div>

            </div>

            <!-- Alıcı Kolonu -->
            <div class="col-md-6">
                <h4>Alıcı Bilgileri</h4>
                <div class="row g-3">
                    <div class="col-12">
                        <label for="receiverName" class="form-label">Ad Soyad / Firma Adı</label>
                        <input type="text" class="form-control" id="receiverName" placeholder="" th:field="*{receiverName}" required>
                        <div class="invalid-feedback" th:if="${#fields.hasErrors('receiverName')}" th:errors="*{receiverName}">
                            Alıcı adı gerekli.
                        </div>
                    </div>
                    <div class="col-12">
                        <label for="receiverAddress" class="form-label">Adres</label>
                        <textarea class="form-control" id="receiverAddress" rows="3" th:field="*{receiverAddress}" required></textarea>
                        <div class="invalid-feedback" th:if="${#fields.hasErrors('receiverAddress')}" th:errors="*{receiverAddress}">
                            Alıcı adresi gerekli.
                        </div>
                    </div>
                    <div class="col-md-6">
                        <label for="receiverCity" class="form-label">Şehir</label>
                        <input type="text" class="form-control" id="receiverCity" placeholder="" th:field="*{receiverCity}" required>
                        <div class="invalid-feedback" th:if="${#fields.hasErrors('receiverCity')}" th:errors="*{receiverCity}">
                            Alıcı şehri gerekli.
                        </div>
                    </div>
                    <div class="col-md-6">
                        <label for="receiverPhone" class="form-label">Telefon</label>
                        <!-- İlçe input'u kaldırıldı -->
                        <input type="tel" class="form-control" id="receiverPhone" placeholder="" th:field="*{receiverPhone}" required>
                        <div class="invalid-feedback" th:if="${#fields.hasErrors('receiverPhone')}" th:errors="*{receiverPhone}">
                            Alıcı telefonu gerekli.
                        </div>
                    </div>
                    <div class="col-12"> <!-- Tam genişlik yaptım -->
                        <label for="receiverEmail" class="form-label">E-posta <span class="text-muted">(SMS/Eposta Bildirim için)</span></label>
                        <input type="email" class="form-control" id="receiverEmail" placeholder="isim@ornek.com" th:field="*{receiverEmail}">
                        <div class="invalid-feedback" th:if="${#fields.hasErrors('receiverEmail')}" th:errors="*{receiverEmail}">
                            Geçerli bir alıcı e-posta adresi girin.
                        </div>
                    </div>
                </div>
                <hr class="my-4">
                <!-- Hizmet Seçenekleri (DTO'da karşılığı olmadığı için şimdilik yorum satırı) -->
                <!-- <h4>Hizmet Seçenekleri</h4>
                 <div class="row g-3">
                     ...
                 </div> -->
            </div>
        </div>

        <hr class="my-4">

        <button class="w-100 btn btn-primary btn-lg" type="submit">Kaydet ve Takip No Oluştur</button>
    </form>

</div> <!-- layout:fragment="content" sonu -->

<!-- Opsiyonel: Sayfaya özel JS -->
<th:block layout:fragment="page_scripts">
    <!-- Gerekirse Bootstrap validation script'i eklenebilir -->
    <script>
        // Example starter JavaScript for disabling form submissions if there are invalid fields
        (() => {
            'use strict'

            // Fetch all the forms we want to apply custom Bootstrap validation styles to
            const forms = document.querySelectorAll('.needs-validation')

            // Loop over them and prevent submission
            Array.from(forms).forEach(form => {
                form.addEventListener('submit', event => {
                    if (!form.checkValidity()) {
                        event.preventDefault()
                        event.stopPropagation()
                    }

                    form.classList.add('was-validated')
                }, false)
            })
        })()
    </script>
</th:block>

</body>
</html>