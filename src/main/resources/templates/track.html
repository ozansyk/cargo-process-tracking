<!doctype html>
<html lang="tr" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Kargo Takip</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding-top: 2rem; padding-bottom: 2rem; background-color: #f8f9fa; }
        .container { max-width: 800px; }
        .card { border: none; box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075); }
        .table { vertical-align: middle; }
        .result-section { margin-top: 2rem; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .badge { vertical-align: middle; }
    </style>
</head>
<body>
<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-10"> <!-- Biraz daha genişlettim -->
            <h2 class="mb-4 text-center">Kargo Durumu Sorgulama</h2>

            <!-- Sorgulama Formu -->
            <div class="card mb-4">
                <div class="card-body">
                    <!-- Formu GET metodu ile aynı sayfaya gönderelim -->
                    <form th:action="@{/track}" method="get" class="input-group mb-0">
                        <input type="text" name="trackingNumber" class="form-control form-control-lg"
                               placeholder="Takip Numaranızı Giriniz..." aria-label="Takip Numarası"
                               th:value="${submittedTrackingNumber}" required> <!-- Input adını 'trackingNumber' yaptık ve önceki değeri bastık -->
                        <button class="btn btn-primary btn-lg" type="submit">Sorgula</button>
                    </form>
                </div>
            </div>

            <!-- Hata Mesajı Alanı -->
            <div th:if="${errorMessage}" class="alert alert-danger mt-3" role="alert" th:text="${errorMessage}">
                Girilen takip numarası bulunamadı! <!-- Bu kısım dinamik olarak değişecek -->
            </div>

            <!-- Sonuç Alanı (trackingInfo modelde varsa gösterilir) -->
            <div th:if="${trackingInfo}" class="result-section" id="resultArea">
                <h3 class="mb-3">Kargo Detayları</h3>
                <div class="card mb-3">
                    <div class="card-body">
                        <p><strong>Takip Numarası:</strong> <span th:text="${trackingInfo.trackingNumber}">XYZ123456789</span></p>
                        <p><strong>Güncel Durum:</strong>
                            <span class="badge fs-6"
                                  th:classappend="${trackingInfo.currentStatusBadgeClass}"
                                  th:text="${trackingInfo.currentStatus}">Dağıtımda</span>
                        </p>
                        <p><strong>Gönderici Şehir:</strong> <span th:text="${trackingInfo.senderCity}">İstanbul</span></p>
                        <p><strong>Alıcı Şehir:</strong> <span th:text="${trackingInfo.receiverCity}">Ankara</span></p>
                        <!-- <p><strong>Tahmini Teslim Tarihi:</strong> Bilgi Yok</p> -->
                        <!-- İsteğe bağlı: Process Instance ID'yi göstermek isterseniz -->
                        <!-- <p><small><strong>Süreç ID:</strong> <span th:text="${trackingInfo.processInstanceId}"></span></small></p> -->
                    </div>
                </div>

                <!-- Gönderi Geçmişi (historyEvents listesi varsa ve boş değilse gösterilir) -->
                <div th:if="${trackingInfo.historyEvents != null and !trackingInfo.historyEvents.isEmpty()}">
                    <h4 class="mt-4 mb-3">Gönderi Geçmişi</h4>
                    <div class="table-responsive"> <!-- Küçük ekranlar için -->
                        <table class="table table-striped table-bordered">
                            <thead class="table-light">
                            <tr>
                                <th scope="col">Tarih ve Saat</th>
                                <th scope="col">İşlem / Durum</th>
                                <th scope="col">Lokasyon</th>
                            </tr>
                            </thead>
                            <tbody>
                            <!-- Liste üzerinde dönerek satırları oluştur -->
                            <tr th:each="event : ${trackingInfo.historyEvents}">
                                <td th:text="${event.timestamp != null ? #temporals.format(event.timestamp, 'dd.MM.yyyy HH:mm:ss') : '-'}">17.10.2023 09:15</td>
                                <td th:text="${event.statusDescription}">Dağıtıma Çıktı</td>
                                <td th:text="${event.location}">Ankara Dağıtım Merkezi</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div th:if="${trackingInfo.historyEvents == null or trackingInfo.historyEvents.isEmpty()}" class="alert alert-light mt-3" role="alert">
                    Bu kargo için henüz gönderi geçmişi bulunmamaktadır.
                </div>
            </div> <!-- resultArea sonu -->
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>