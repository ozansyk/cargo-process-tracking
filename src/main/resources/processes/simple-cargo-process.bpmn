<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:flowable="http://flowable.org/bpmn" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:omgdc="http://www.omg.org/spec/DD/20100524/DC" xmlns:omgdi="http://www.omg.org/spec/DD/20100524/DI" targetNamespace="http://www.example.org/SimpleCargoTracking">
  <process id="simpleCargoProcess" name="Cargo Process with Validation" isExecutable="true">
    <startEvent id="startEvent" name="Cargo Received Event"/>
    <sequenceFlow id="flow1" sourceRef="startEvent" targetRef="persistReceivedTask"/>
    <serviceTask id="persistReceivedTask" name="Persist Status RECEIVED" flowable:delegateExpression="#{persistStatusWorker}"></serviceTask>
    <!-- persistReceivedTask'tan sonraki akış yeni User Task'a gidiyor -->
    <sequenceFlow id="flow2" sourceRef="persistReceivedTask" targetRef="validateCargoTask"/>
    <!-- YENİ KULLANICI GÖREVİ (USER TASK) -->
    <!-- Bu görev, bir kullanıcı tarafından manuel olarak tamamlanana kadar akış burada bekler -->
    <!-- Görevi belirli bir kullanıcıya veya gruba atamak için flowable:assignee, flowable:candidateUsers veya flowable:candidateGroups kullanabilirsiniz -->
    <userTask id="validateCargoTask" name="Validate Cargo Details">
      <!-- Örnek: Görevi 'kargo_validator' grubuna atama -->
      <!-- <potentialOwner>
                 <resourceAssignmentExpression>
                     <formalExpression>group(kargo_validator)</formalExpression>
                 </resourceAssignmentExpression>
             </potentialOwner> -->
      <!-- Veya belirli bir kullanıcıya atama: flowable:assignee="ozan" -->
    </userTask>
    <!-- User Task tamamlandıktan sonra End Event'e giden yeni akış -->
    <sequenceFlow id="flow3" sourceRef="validateCargoTask" targetRef="endEvent"/>
    <endEvent id="endEvent" name="Process Ended"/>
  </process>
  <!-- *** GÖRSEL BİLGİLER (Diagram Interchange - DI) *** -->
  <!-- Süreç ID'si değiştiği için diagram/plane ID'lerini de güncelleyelim -->
  <bpmndi:BPMNDiagram id="BPMNDiagram_simpleCargoProcess">
    <bpmndi:BPMNPlane id="BPMNPlane_simpleCargoProcess" bpmnElement="simpleCargoProcess">
      <!-- Start Event Şekli (Konum aynı kalabilir) -->
      <bpmndi:BPMNShape id="BPMNShape_startEvent" bpmnElement="startEvent">
        <omgdc:Bounds x="100" y="100" width="36" height="36"/>
      </bpmndi:BPMNShape>
      <!-- Service Task Şekli (Konum aynı kalabilir) -->
      <bpmndi:BPMNShape id="BPMNShape_persistReceivedTask" bpmnElement="persistReceivedTask">
        <omgdc:Bounds x="200.0" y="78.0" width="100" height="80"/>
      </bpmndi:BPMNShape>
      <!-- YENİ USER TASK ŞEKLİ -->
      <!-- Service Task'tan sonra yerleştirelim -->
      <bpmndi:BPMNShape id="BPMNShape_validateCargoTask" bpmnElement="validateCargoTask">
        <omgdc:Bounds x="360" y="78" width="100" height="80"/>
      </bpmndi:BPMNShape>
      <!-- End Event Şekli (Sağa kaydıralım) -->
      <bpmndi:BPMNShape id="BPMNShape_endEvent" bpmnElement="endEvent">
        <omgdc:Bounds x="520" y="100" width="36" height="36"/>
      </bpmndi:BPMNShape>
      <!-- Sequence Flow 1 Oku (startEvent -> persistReceivedTask) - Aynı kaldı -->
      <bpmndi:BPMNEdge id="BPMNEdge_flow1" bpmnElement="flow1">
        <omgdi:waypoint x="136" y="118"/>
        <omgdi:waypoint x="200.0" y="118.0"/>
      </bpmndi:BPMNEdge>
      <!-- Sequence Flow 2 Oku (persistReceivedTask -> validateCargoTask) - Hedef değişti -->
      <bpmndi:BPMNEdge id="BPMNEdge_flow2" bpmnElement="flow2">
        <omgdi:waypoint x="300.0" y="118.0"/>
        <!-- persistReceivedTask çıkış -->
        <omgdi:waypoint x="360" y="118"/>
        <!-- validateCargoTask giriş -->
      </bpmndi:BPMNEdge>
      <!-- YENİ Sequence Flow 3 Oku (validateCargoTask -> endEvent) -->
      <bpmndi:BPMNEdge id="BPMNEdge_flow3" bpmnElement="flow3">
        <omgdi:waypoint x="460" y="118"/>
        <!-- validateCargoTask çıkış -->
        <omgdi:waypoint x="520" y="118"/>
        <!-- endEvent giriş -->
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</definitions>
